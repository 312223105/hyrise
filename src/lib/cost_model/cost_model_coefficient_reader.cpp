#include "cost_model_coefficient_reader.hpp"

namespace opossum {

const CoefficientsPerGroup CostModelCoefficientReader::default_coefficients() {
  CoefficientsPerGroup all_coefficients{};

  const auto table_scan_coefficients = read_table_scan_coefficients();
  const auto join_coefficients = read_join_coefficients();

  all_coefficients.insert(table_scan_coefficients.begin(), table_scan_coefficients.end());
  all_coefficients.insert(join_coefficients.begin(), join_coefficients.end());

  return all_coefficients;
}

// Hard-coded efficients for now
const CoefficientsPerGroup CostModelCoefficientReader::read_table_scan_coefficients(const std::string& file_path) {
  return {{ModelGroup{OperatorType::TableScan, DataType::Int, false, false},
           {{"left_input_row_count", 3.6579310596},
            //                          {"is_result_empty", -3894.4296670012},
            {"selectivity", 11285.9587666981},
            {"first_column_is_reference_segment", 0},
            {"second_column_is_reference_segment", 0},
            {"third_column_is_reference_segment", 0},
            {"is_column_comparison", -1721.1127107658},
            {"computable_or_column_expression_count", 14227.0873454307},
            {"is_selectivity_below_50_percent", 1874.7617189885},
            {"selectivity_distance_to_50_percent", -17721.3571372186},
            //                          {"is_small_table", 0},
            {"first_column_segment_encoding_Unencoded_percentage", 875.4659477475},
            {"first_column_segment_encoding_Dictionary_percentage", -2466.8790265752},
            {"first_column_segment_encoding_RunLength_percentage", 807.0515189504},
            {"first_column_segment_encoding_FixedStringDictionary_percentage", 0},
            {"first_column_segment_encoding_FrameOfReference_percentage", 2365.7972807862},
            //                          {"first_column_segment_encoding_undefined", 0},
            //                          {"first_column_data_type_null", 1581.4357209088},
            {"first_column_data_type_int", 1581.4357209088},
            {"first_column_data_type_long", 1581.4357209088},
            {"first_column_data_type_float", 1581.4357209088},
            {"first_column_data_type_double", 1581.4357209088},
            {"first_column_data_type_string", 1581.4357209088},
            {"first_column_data_type_undefined", 1581.4357209088},
            {"second_column_segment_encoding_Unencoded_percentage", -156.771035114},
            {"second_column_segment_encoding_Dictionary_percentage", -504.0943341712},
            {"second_column_segment_encoding_RunLength_percentage", -691.4961272456},
            {"second_column_segment_encoding_FixedStringDictionary_percentage", 0},
            {"second_column_segment_encoding_FrameOfReference_percentage", -368.7512142351},
            //                          {"second_column_segment_encoding_undefined", 3302.5484316746},
            //                          {"second_column_data_type_null", -1721.1127107658},
            {"second_column_data_type_int", -1721.1127107658},
            {"second_column_data_type_long", -1721.1127107658},
            {"second_column_data_type_float", -1721.1127107658},
            {"second_column_data_type_double", -1721.1127107658},
            {"second_column_data_type_string", -1721.1127107658},
            {"second_column_data_type_undefined", 3302.5484316746},
            {"third_column_segment_encoding_Unencoded_percentage", 4453.3879124653},
            {"third_column_segment_encoding_Dictionary_percentage", 2251.3754879083},
            {"third_column_segment_encoding_RunLength_percentage", 3768.4614356163},
            {"third_column_segment_encoding_FixedStringDictionary_percentage", 0},
            {"third_column_segment_encoding_FrameOfReference_percentage", 2312.1037783889},
            //                          {"third_column_segment_encoding_undefined", -11203.8928934701},
            //                          {"third_column_data_type_null", 12785.3286143789},
            {"third_column_data_type_int", 12785.3286143789},
            {"third_column_data_type_long", 12785.3286143789},
            {"third_column_data_type_float", 12785.3286143789},
            {"third_column_data_type_double", 12785.3286143789},
            {"third_column_data_type_string", 12785.3286143789},
            {"third_column_data_type_undefined", -11203.892893470}}}};
}

const CoefficientsPerGroup CostModelCoefficientReader::read_join_coefficients(const std::string& file_path) {
  return {{ModelGroup{OperatorType::JoinHash},
           {{"input_table_size_ratio", 27.65314136506545},
                   {"left_column_memory_usage_bytes", 1.2565338332739553},
                   {"left_column_is_reference_segment", 3680.7994126538592},
                   {"left_column_segment_encoding_Dictionary_percentage", 2361.5679202958727},
                   {"left_column_segment_encoding_RunLength_percentage", 9297.860271198751},
                   {"left_column_segment_encoding_Unencoded_percentage", -2474.6627029245005},
                   {"left_input_row_count", -17.208512834779405},
                   {"right_column_memory_usage_bytes", 2.3029261411437627},
                   {"right_column_is_reference_segment", 3680.7994126492836},
                   {"right_column_segment_encoding_Dictionary_percentage", 2361.567920293213},
                   {"right_column_segment_encoding_RunLength_percentage", 9297.860271201636},
                   {"right_column_segment_encoding_Unencoded_percentage", -2474.662702924911},
                   {"right_input_row_count", 38.39158355362945},
                   {"total_row_count", 9.500822345665507e-06},
                   {"logical_cost_sort_merge", 1.3751170002773674},
                   {"logical_cost_hash", 21.183070329061778},
                   {"left_column_data_type_int", 9184.765488569828},
                   {"operator_type_JoinHash", 9184.765488569828},
                   {"operator_type_JoinIndex", 0.0},
                   {"operator_type_JoinNestedLoop", 0.0},
                   {"operator_type_JoinMPSM", 0.0},
                   {"operator_type_JoinSortMerge", 0.0},
                   {"right_column_data_type_int", 9184.76548856982}}},
          {ModelGroup{OperatorType::JoinNestedLoop},
           {{"input_table_size_ratio", -8.012601530333692},
                   {"left_column_memory_usage_bytes", 0.15541270758557935},
                   {"left_column_is_reference_segment", 9617.626815262001},
                   {"left_column_segment_encoding_Dictionary_percentage", 1628.5082253010419},
                   {"left_column_segment_encoding_RunLength_percentage", 7879.441134040131},
                   {"left_column_segment_encoding_Unencoded_percentage", -2409.279601481431},
                   {"left_input_row_count", 19.60937917830816},
                   {"right_column_memory_usage_bytes", 1.564960733952519},
                   {"right_column_is_reference_segment", 9617.62681526284},
                   {"right_column_segment_encoding_Dictionary_percentage", 1628.5082253022824},
                   {"right_column_segment_encoding_RunLength_percentage", 7879.441134039725},
                   {"right_column_segment_encoding_Unencoded_percentage", -2409.2796014814585},
                   {"right_input_row_count", -12.819313949495701},
                   {"total_row_count", 1.4703916810647812},
                   {"logical_cost_sort_merge", 0.11977322429809911},
                   {"logical_cost_hash", 6.790065229050505},
                   {"left_column_data_type_int", 7098.669757860545},
                   {"operator_type_JoinHash", 0.0},
                   {"operator_type_JoinIndex", 0.0},
                   {"operator_type_JoinNestedLoop", 7098.669757860545},
                   {"operator_type_JoinMPSM", 0.0},
                   {"operator_type_JoinSortMerge", 0.0},
                   {"right_column_data_type_int", 7098.66975786055}}},
          {ModelGroup{OperatorType::JoinMPSM},
           {{"input_table_size_ratio", -10.184384165028224},
                   {"left_column_memory_usage_bytes", 8.32965208162337},
                   {"left_column_is_reference_segment", 8595.96582200309},
                   {"left_column_segment_encoding_Dictionary_percentage", 4380.40555566182},
                   {"left_column_segment_encoding_RunLength_percentage", 10000.95520110222},
                   {"left_column_segment_encoding_Unencoded_percentage", 998.4041598876584},
                   {"left_input_row_count", -6.933748949538827},
                   {"right_column_memory_usage_bytes", 2.213062210752746},
                   {"right_column_is_reference_segment", 8595.965821998943},
                   {"right_column_segment_encoding_Dictionary_percentage", 4380.405555658878},
                   {"right_column_segment_encoding_RunLength_percentage", 10000.955201098299},
                   {"right_column_segment_encoding_Unencoded_percentage", 998.4041598877184},
                   {"right_input_row_count", 15.988275244096283},
                   {"total_row_count", 8.020945558786515e-06},
                   {"logical_cost_sort_merge", 2.238099410778537},
                   {"logical_cost_hash", 9.054525745857202},
                   {"left_column_data_type_int", 15379.764916645294},
                   {"operator_type_JoinHash", 0.0},
                   {"operator_type_JoinIndex", 0.0},
                   {"operator_type_JoinNestedLoop", 0.0},
                   {"operator_type_JoinMPSM", 15379.764916645294},
                   {"operator_type_JoinSortMerge", 0.0},
                   {"right_column_data_type_int", 15379.76491664529}}},
          {ModelGroup{OperatorType::JoinSortMerge},
           {{"input_table_size_ratio", -15.317028962264477},
                   {"left_column_memory_usage_bytes", 6.422872950639001},
                   {"left_column_is_reference_segment", 7151.260698298924},
                   {"left_column_segment_encoding_Dictionary_percentage", 2431.0011925494464},
                   {"left_column_segment_encoding_RunLength_percentage", 7457.418362664272},
                   {"left_column_segment_encoding_Unencoded_percentage", -1689.1254834186539},
                   {"left_input_row_count", -10.096240983298213},
                   {"right_column_memory_usage_bytes", 2.9957595092581557},
                   {"right_column_is_reference_segment", 7151.260698300085},
                   {"right_column_segment_encoding_Dictionary_percentage", 2431.001192547062},
                   {"right_column_segment_encoding_RunLength_percentage", 7457.418362665754},
                   {"right_column_segment_encoding_Unencoded_percentage", -1689.1254834186375},
                   {"right_input_row_count", 10.661198856941136},
                   {"total_row_count", 6.693604669416015e-06},
                   {"logical_cost_sort_merge", 3.0513866416890476},
                   {"logical_cost_hash", 0.5649573819353408},
                   {"left_column_data_type_int", 8199.294071793704},
                   {"operator_type_JoinHash", 0.0},
                   {"operator_type_JoinIndex", 0.0},
                   {"operator_type_JoinNestedLoop", 0.0},
                   {"operator_type_JoinMPSM", 0.0},
                   {"operator_type_JoinSortMerge", 8199.294071793704},
                   {"right_column_data_type_int", 8199.29407179370}}}};
}

}  // namespace opossum
